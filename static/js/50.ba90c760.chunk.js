!function(){"use strict";function r(r,n){(null==n||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}function n(n,t){if(n){if("string"===typeof n)return r(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(n,t):void 0}}function t(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,n){var t=null==r?null:"undefined"!==typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,i,o=[],a=!0,s=!1;try{for(t=t.call(r);!(a=(e=t.next()).done)&&(o.push(e.value),!n||o.length!==n);a=!0);}catch(u){s=!0,i=u}finally{try{a||null==t.return||t.return()}finally{if(s)throw i}}return o}}(r,t)||n(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(r,t){var e="undefined"!==typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=n(r))||t&&r&&"number"===typeof r.length){e&&(r=e);var i=0,o=function(){};return{s:o,n:function(){return i>=r.length?{done:!0}:{done:!1,value:r[i++]}},e:function(r){throw r},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){e=e.call(r)},n:function(){var r=e.next();return s=r.done,r},e:function(r){u=!0,a=r},f:function(){try{s||null==e.return||e.return()}finally{if(u)throw a}}}}function i(t){return function(n){if(Array.isArray(n))return r(n)}(t)||function(r){if("undefined"!==typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function a(r,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function s(r,n,t){return n&&a(r.prototype,n),t&&a(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}var u=function(){function r(n,t,e,i,a){o(this,r),this.typeName=void 0,this.rawExpression=void 0,this.subExpressions=void 0,this.evalFunc=void 0,this.props=void 0,this.typeName=n,this.rawExpression=t,this.subExpressions=e,this.evalFunc=i,this.props=a}return s(r,[{key:"eval",value:function(r){return this.evalFunc(r,this)}}]),r}(),c=function(){function r(n,t,e,i,a,s){o(this,r),this.typeName=void 0,this.regex=void 0,this.parseFunc=void 0,this.evalFunc=void 0,this.min=void 0,this.max=void 0,this.typeName=n,this.regex=t,this.parseFunc=a,this.evalFunc=s,this.min=e,this.max=i}return s(r,[{key:"create",value:function(r,n){if(this.min&&n.length<this.min||this.max&&n.length>this.max)throw Error('Invalid syntax in "'.concat(r,'": ').concat(this.typeName," expected between ").concat(this.min," and ").concat(this.max," operands but got ").concat(n.length));var t;if(!(t=n.length>0?this.regex.exec(r.substring(n[0].rawExpression.length)):this.regex.exec(r)))throw new Error("Unexpected match failure for ".concat(this.typeName,' in "').concat(r,'"'));var e=this.parseFunc(t,n);return new u(this.typeName,r,n,this.evalFunc,e)}}]),r}(),l=function(){return{}};function f(r,n,t,e,i){return new c(r,n,2,t,e,i)}function v(r,n,t,e){return new c(r,n,0,0,t,e)}var p=Math.random,h=function(r){return r.reduce((function(r,n){return r+n}),0)},d=function(r){return Math.floor(p()*r)+1},m=function(r,n){if(!n.includes(r.typeName))throw Error('Type of "'.concat(r.rawExpression,'" was expected to be one of "').concat(n,'", but was "').concat(r.typeName,'"'));return r.typeName},b=[f("assign",/:=/,2,(function(r,n){return{storedType:m(n[0],["variable","function"])}}),(function(r,n){if("function"===n.props.storedType){var t,e=null===(t=n.subExpressions[0].props)||void 0===t?void 0:t.funcName;r.funcReg.set(e,n.subExpressions[1])}else if("variable"===n.props.storedType){var i,o=null===(i=n.subExpressions[0].props)||void 0===i?void 0:i.varName;r.varReg.set(o,n.subExpressions[1].eval(r))}return 0})),f("check",/=>/,2,l,(function(r,n){return n.subExpressions[0].eval(r)?n.subExpressions[1].eval(r):0})),f("attack",/=atk(?::(\d+))?(?::(adv|dis)(\d+)?)?>/,2,(function(r){return{critmin:Number(r[1]||20),vantage:(n=r[2],t=r[3],"adv"===n?Number(t||2):"dis"===n?-Number(t||2):0)};var n,t}),(function(r,n){var t=n.props,e=n.subExpressions,o=d(20);if(t.vantage>1||t.vantage<-1){var a=function(r,n,t){if(void 0===n&&(n=r,r=0),void 0===t&&(t=1),t>0&&r>=n||t<0&&r<=n)return[];for(var e=[],i=r;t>0?i<n:i>n;i+=t)e.push(i);return e}(Math.abs(t.vantage)-1).map((function(){return d(20)}));o=(t.vantage>0?Math.max:Math.min).apply(void 0,[o].concat(i(a)))}var s=o>=t.critmin;if(s||e[0].eval(r)+o>=r.ac){r.pushCrit(s);var u=e[1].eval(r);return r.popCrit(),u}return 0})),f("save",/=sav:(\d+)(?::(adv|dis))?>/,2,(function(r){var n;return{successmod:null!==(n=Number(r[1])/100)&&void 0!==n?n:.5,vantage:r[2]}}),(function(r,n){var t=d(20);"adv"===n.props.vantage?t=Math.max(t,d(20)):"dis"===n.props.vantage&&(t=Math.min(t,d(20)));var e=n.subExpressions[1].eval(r);return t+r.sm>=n.subExpressions[0].eval(r)?Math.floor(e*n.props.successmod):e})),f("gte",/>=/,2,l,(function(r,n){return Number(n.subExpressions[0].eval(r)>=n.subExpressions[1].eval(r))})),f("lte",/<=/,2,l,(function(r,n){return Number(n.subExpressions[0].eval(r)<=n.subExpressions[1].eval(r))})),f("add",/\+/,999,l,(function(r,n){return h(n.subExpressions.map((function(n){return n.eval(r)})))})),f("sub",/-(?!>)/,999,l,(function(r,n){return n.subExpressions[0].eval(r)-h(n.subExpressions.slice(1).map((function(n){return n.eval(r)})))})),f("mul",/\*/,999,l,(function(r,n){return n.subExpressions.reduce((function(n,t){return n*t.eval(r)}),1)})),f("div",/\//,2,l,(function(r,n){return Math.floor(n.subExpressions[0].eval(r)/n.subExpressions[1].eval(r))})),f("repeat",/#/,2,l,(function(r,n){return h(i(new Array(Number(n.subExpressions[0].eval(r)))).map((function(){return n.subExpressions[1].eval(r)})))})),f("reroll_lte",/@rrlte:/,2,l,(function(r,n){var t=n.subExpressions[0].eval(r);return t<=n.subExpressions[1].eval(r)?n.subExpressions[0].eval(r):t}))],y=[v("number",/^\d+$/,(function(r){return{value:Number(r[0])}}),(function(r,n){return n.props.value})),v("roll",/^(\d*)d(\d+)(?:k(h|l)(\d+))?$/,(function(r){return{dice:new Array(Number(r[1]||1)).fill(Number(r[2])),keep:("l"===r[3]?-1:1)*Number(r[4]||r[1]||1)}}),(function(r,n){var t=n.props,e=t.dice.map(d).sort((function(r,n){return(n-r)*Math.sign(t.keep)})).slice(0,Math.abs(t.keep||t.dice.length));return h(e)})),v("roll_crit",/^(\d*)D(\d+)?$/,(function(r){return{dice:new Array(Number(r[1]||1)).fill(Number(r[2]))}}),(function(r,n){var t=n.props;return h(t.dice.map((function(n){return d(n)+(r.crit()?d(n):0)})))})),v("armor_class",/^AC$/,l,(function(r,n){return r.ac})),v("prof_bonus",/^PB$/,l,(function(r,n){return r.pb})),v("level",/^LV$/,l,(function(r,n){return r.level})),v("crit_mult",/^CM$/,l,(function(r,n){return 1*Number(r.crit())+1})),v("crit_binary",/^CB$/,l,(function(r,n){return 1*Number(r.crit())})),v("empty",/^$/,l,(function(r,n){return 0})),v("variable",/^\$([\d\w]+)$/,(function(r){return{varName:r[1]}}),(function(r,n){return r.varReg.get(n.props.varName)||0})),v("function",/^@([\d\w]+)$/,(function(r){return{funcName:r[1]}}),(function(r,n){var t;return(null===(t=r.funcReg.get(n.props.funcName))||void 0===t?void 0:t.eval(r))||0}))];function g(r,n,t){var e=r.exec(n.substring(t));return 0===(null===e||void 0===e?void 0:e.index)?null===e||void 0===e?void 0:e[0]:void 0}function x(r,n,t){1===t&&n.startsWith("(")&&n.endsWith(")")&&(n=n.substring(1,n.length-1)),r.push(n)}function E(r,n){for(var t=[],e=0,i="",o=0,a=0;a<r.length;){var s=r[a];"("===s?e+=1:")"===s&&0===(e-=1)&&(o+=1);var u=g(n,r,a);0===e&&u?(x(t,i,o),i="",o=0,a+=u.length):(i+=s,a+=1)}if(0!==e)throw Error('Unbalanced parentheses in expression "'.concat(r,'"'));return x(t,i,o),[t,o]}function w(r){var n,i=e(b);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=t(E(r,o.regex),2),s=a[0],u=a[1];if(1===s.length&&1===u&&r.startsWith("(")&&r.endsWith(")"))return w(s[0]);if(s.length>1)return o.create(r,s.map(w))}}catch(v){i.e(v)}finally{i.f()}var c,l=e(y);try{for(l.s();!(c=l.n()).done;){var f=c.value;if(f.regex.exec(r))return f.create(r,[])}}catch(v){l.e(v)}finally{l.f()}throw Error('Invalid expression: "'.concat(r,'"'))}var N=function(){function r(n){o(this,r),this.ac=void 0,this.level=void 0,this.pb=void 0,this.sm=void 0,this.critStack=void 0,this.funcReg=void 0,this.varReg=void 0,this.ac=n.ac,this.sm=n.sm,this.pb=n.pb,this.level=n.level,this.varReg=new Map,this.funcReg=new Map,this.critStack=[]}return s(r,[{key:"crit",value:function(){return!!this.critStack[this.critStack.length-1]}},{key:"popCrit",value:function(){this.critStack.pop()}},{key:"pushCrit",value:function(r){this.critStack.push(r)}},{key:"reset",value:function(){this.critStack.length=0,this.funcReg.clear(),this.varReg.clear()}}]),r}();var k,M,S=function(){function r(n,t){o(this,r),this.rawExpression=void 0,this.rootExpression=void 0,this.rawExpression=n,this.rootExpression=t}return s(r,[{key:"run",value:function(r){return this.rootExpression.eval(r)}}]),r}();onmessage=function(r){var n=r.data;if("configure"===n.command){var t=n.expression,e=n.config;k=new S(t,w(t)),M=e}else if("run"===n.command){var o=function(r){if(!k||!M)throw new Error("Worker is not configured!");for(var n=[],t=new N(M),e=0;e<r;e++)t.reset(),n.push(k.run(t));return function(r){if(!r.length)throw Error("Cannot calculate stats for empty array");var n=r.reduce((function(r,n){return r+n}))/r.length;return{count:r.length,min:Math.min.apply(Math,i(r)),max:Math.max.apply(Math,i(r)),mean:n,stdev:Math.sqrt(r.reduce((function(r,t){return r+Math.pow(t-n,2)}),0)/(r.length-1))}}(n)}(n.iterations);this.postMessage({command:"complete",stats:o})}}}();
//# sourceMappingURL=50.ba90c760.chunk.js.map